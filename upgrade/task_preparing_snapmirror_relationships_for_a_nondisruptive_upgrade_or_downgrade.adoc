---
permalink: upgrade/task_preparing_snapmirror_relationships_for_a_nondisruptive_upgrade_or_downgrade.html 
sidebar: sidebar 
keywords: ontap, upgrade, snapmirror, operations, quisce 
summary: Si consiglia di interrompere le operazioni di SnapMirror prima di eseguire un aggiornamento senza interruzioni di ONTAP. 
---
= Preparare le relazioni di SnapMirror per un aggiornamento di ONTAP
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Prima di eseguire l'upgrade di ONTAP su un cluster che esegue SnapMirror, è necessario predisporre le operazioni SnapMirror per ogni nodo che contiene volumi di destinazione e ciascuna SVM sottoposta a peering deve avere un nome univoco nei cluster. Si consiglia di utilizzare un nome di dominio completo (FQDN) univoco per ciascuna SVM, ad esempio "VataVerser.HQ" o "mirorVserver.Offsite".

Occorre anche tenere presente che per l'upgrade dei cluster con relazioni DP SnapMirror è necessario aggiornare i nodi di destinazione prima di aggiornare i nodi di origine.



== Interrompere le operazioni di SnapMirror prima di eseguire l'aggiornamento di ONTAP

Per evitare errori nei trasferimenti SnapMirror, è necessario interrompere le operazioni di SnapMirror. In alternativa, è possibile disattivare i trasferimenti SnapMirror su un particolare volume di destinazione e aggiornare il nodo di destinazione proprietario prima di aggiornare i nodi di origine, in modo che i trasferimenti di SnapMirror per tutti gli altri volumi di destinazione possano continuare. Nella seguente tabella vengono descritte le due opzioni per la sospensione delle operazioni di SnapMirror.

[cols="3*"]
|===
| Opzione | Descrizione | Aggiornare i nodi di destinazione prima dei nodi di origine? 


 a| 
Sospendere le operazioni SnapMirror per la durata dell'NDU (aggiornamento senza interruzioni).
 a| 
Il metodo più semplice per l'aggiornamento in un ambiente SnapMirror consiste nel sospendere tutte le operazioni di SnapMirror, eseguire l'aggiornamento e quindi riprendere le operazioni di SnapMirror. Tuttavia, non si verificheranno trasferimenti SnapMirror durante l'intera NDU. È necessario utilizzare questo metodo se il cluster contiene nodi che eseguono il mirroring dei volumi l'uno rispetto all'altro.
 a| 
No, i nodi possono essere aggiornati in qualsiasi ordine.



 a| 
Sospendere le operazioni di SnapMirror un volume di destinazione alla volta.
 a| 
È possibile sospendere i trasferimenti SnapMirror per un particolare volume di destinazione, aggiornare il nodo (o coppia ha) che contiene il volume di destinazione, aggiornare il nodo (o coppia ha) che contiene il volume di origine e quindi riprendere i trasferimenti SnapMirror per il volume di destinazione. Utilizzando questo metodo, i trasferimenti SnapMirror per tutti gli altri volumi di destinazione possono continuare mentre i nodi che contengono i volumi di destinazione e di origine originali vengono aggiornati.
 a| 
Sì.

|===
.Fasi
. Determinare il percorso di destinazione per ogni relazione di SnapMirror:
+
[source, cli]
----
snapmirror show
----
. Per ogni volume di destinazione, sospendere i trasferimenti futuri di SnapMirror:
+
[source, cli]
----
snapmirror quiesce -destination-path destination
----
+
Se non ci sono trasferimenti attivi per la relazione SnapMirror, questo comando imposta il suo stato su "Quiesced". Se la relazione ha trasferimenti attivi, lo stato viene impostato su "Quiescing" (Quiescing) fino al completamento del trasferimento, quindi lo stato diventa "Quiesced" (Quiesced).

+
Questo esempio mette in pausa i trasferimenti che coinvolgono il volume di destinazione "vol1" da "SVMvs0.example.com":

+
[listing]
----
cluster1::> snapmirror quiesce -destination-path vs0.example.com:vol1
----
. Verificare che tutte le relazioni di SnapMirror siano state rinunciate:
+
`snapmirror show -status !Quiesced`

+
Questo comando visualizza tutte le relazioni SnapMirror _non_ rinunciate.

+
Questo esempio mostra che tutte le relazioni di SnapMirror sono state rinunciate:

+
[listing]
----
cluster1::> snapmirror show -status !Quiesced
There are no entries matching your query.
----
. Se le relazioni SnapMirror sono attualmente in fase di trasferimento, eseguire una delle seguenti operazioni:
+
[cols="2*"]
|===
| Opzione | Descrizione 


 a| 
Attendere il completamento dei trasferimenti prima di eseguire l'aggiornamento del ONTAP.
 a| 
Al termine di ogni trasferimento, la relazione passa allo stato "Quiesced".



 a| 
Interrompere i trasferimenti:

`snapmirror abort -destination-path destination -h`

*Nota:* è necessario utilizzare `-foreground true` parametro se si stanno terminando i trasferimenti mirror di condivisione del carico.
 a| 
Questo comando interrompe il trasferimento di SnapMirror e ripristina il volume di destinazione sull'ultima copia Snapshot trasferita correttamente. La relazione viene impostata sullo stato "Quiesced" (Quiesced).

|===

